{% extends "base.html" %}
{% block headex %}
<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=9e96a5e2d1484110e610c4df54838615"></script>
<link rel="stylesheet" href="http://cache.amap.com/lbs/static/main1119.css"/>
{% endblock %}
{% block content %}
<div class="container">
	<div class="container col-lg-3">			
	</div>
	<div class="container col-lg-8">
		{% for act in joined_list %}
		<div class="row" style="padding-top: 30px">
			<div class="col-lg-4">
			{% if act.category == 'EN' %}
				<img src="/media/categories/entertainment.jpg" class="img-rounded" width="200px" height="200px">
			{% elif act.category == 'SP' %}
				<img src="/media/categories/sport.jpg" class="img-rounded" width="200px" height="200px">
			{% elif act.category == 'TR' %}
				<img src="/media/categories/travel.jpg" class="img-rounded" width="200px" height="200px">
			{% endif %}
			<p class="text-center"><span class="glyphicon glyphicon-tag" aria-hidden="true"></span>{{act.get_category}}@{{act.get_title}}</p>
			</div>
			<div class="col-lg-6">
				<div>
					<span class="glyphicon glyphicon-flag"></span><img class="img-circle" src="{{act.advocator.profile.url}}" width="60px" height="60px">
					<span style="padding-left: 20px">
						<span class="glyphicon glyphicon-user"></span>
							{% for f in act.person_joined.all %}
								{% if f != act.advocator %}
									<img class="img-circle" src="{{f.profile.url}}" width="30px" height="30px">
								{% endif %}
							{% endfor %}
					</span>
				</div>
				{% if act.is_active %}
					<h3><small>Before begin....</small></h3>
					<div class="progress">
					  <div id="progress{{forloop.counter0}}" class="progress-bar progress-bar-info progress-bar-striped" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 85.5%">
					    <span class="sr-only">40% Complete (success)</span>
					  </div>
					</div>
					<script>
						var a = {{act.get_rest_time.total_seconds}};
						var b = {{act.get_startDpub_time.total_seconds}};
						var percent = a/b*100;
						var progress = document.getElementById("progress{{forloop.counter0}}");
						//alert(progress);
						if (percent>60){
							//alert('asdf');
							progress.className="progress-bar progress-bar-danger progress-bar-striped"
						}
						progress.style.width = percent+"%";
					</script>
				{% elif act.is_going %}
				{% elif act.is_due %}
				{% endif %}
				<!-- Button trigger modal -->
				<button type="button" class="btn btn-primary btn-sm pull-right" data-toggle="modal" data-target="#myModal{{act.id}}" onclick="show({{act.id}},{{act.get_slng}},{{act.get_slat}},{{act.get_dlng}},{{act.get_dlat}},'{{act.get_st_place}}','{{act.get_ds_place}}')">
				  View map
				</button>

				<!-- Modal -->
				<div class="modal fade" id="myModal{{act.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
					<div class="modal-dialog" role="document">
						<div class="modal-content">
				      		<div class="modal-header">
				        	<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				       		 <h4 class="modal-title" id="myModalLabel">View map</h4>
				      		</div>
				      	<div class="modal-body">
				      		<!--MAP-->
				      		<div id="map{{act.id}}" style="height: 300px"></div>
				      		<script type="text/javascript">
				      			function show(id,slng,slat,dlng,dlat,sp,dp) {
					      			var map=new AMap.Map("map"+id,{
								        resizeEnable: true,
								        zoom:15,
								        center: [dlng, dlat],
								    });	
								    var marker = new AMap.Marker({
							            map:map,
							            position: [dlng, dlat],
							            bubble:true,
							        	})
							        if (slng!=-360 &&slat!=-360){
								        var marker1 = new AMap.Marker({
								        	map:map,
								        	bubble:true,
								        	position:[slng,slat],
								        })
								        marker1.setLabel({
								        	offset: new AMap.Pixel(20,20),
								        	content:"starting... "+sp
								        })
							        }
							        marker.setAnimation('AMAP_ANIMATION_BOUNCE');
									marker.setLabel({//label默认蓝框白底左上角显示，样式className为：amap-marker-label
									        offset: new AMap.Pixel(20, 20),//修改label相对于maker的位置
									        content: "destination "+dp
									    });
									map.setFitView();
				      			}
				      		</script>
				      	</div>
				      	<div class="modal-footer">
				        	<button type="button" class="btn btn-default pull-right" data-dismiss="modal">	Close</button>
				     	 </div>
				    	</div>
				  	</div>
				</div>
			</div>	
		</div>
		{% endfor %}
	</div>	
</div>


{% endblock %}